<div class="my-page img-fluid">
  <% if flash[:level_up] %>
    <div class="levelup-back">
      <div class="levelup-char">
        <img src="/assets/character/brave.png">
        <img src="/assets/character/witch.png">
        <img src="/assets/character/priest.png">
        <img src="/assets/character/princess.png">
      </div>
      <p class="levelup-text"><%= flash[:level_up] %></p>
    </div>
  <% end %>
  <div class="container">
    <div class="row">
      <div class="col-lg-3 col-md-0 col-sm-0">
        <p class="notice-message"><%= flash[:notice] %></p>
        <p class="menu-logo upper-contents"> M E N U </p>
        <div class="menu-icon">
            <%= attachment_image_tag @user, :profile_image, size: "100x100", fallback: "character/brave.png" %>
            <p>しゅじんこう </p>
        </div>
          <div class="menu">
            <p>なまえ: <%= @user.name %></p>
            <p class="user-level">ステータス: Lv.<%= @user_level %></p>
            <p class="doc-count">ぼうけん: <%= @documents.count %> 回</p>
            <p>クリア: <%= clear_count(params[:id]) %>回</p>
            <a class="js-modal-open" href="" data-target="modal-user-edit">へんしゅう</a>
            <%= render "users/edit", user: @user %>
          </div>
          <div class="menu-icon">
            <img src="/assets/icon/books.png">
            <p>もくひょう </p>
          </div>
          <div class="menu">

            <% if @goals.exists? %>
              <% user_goals.first(4).each do |goal| %>
                <a class="js-modal-open my-goal" href="" data-target="modal-goal-show">
                  <%= goal.category %> </br>
                  Lv.<%= cat_level(goal.id) %>
                </a>
                <p>つぎのもくひょう:</br>
                <% if Document.where(goal_id: goal.id).exists? %>
                  <%= latest_milestone(goal.id) %>
                <% else %>
                  <a class="js-modal-open" href="" data-target="modal-new-doc">ぼうけんをきろくする</a>
                <% end %>
                </p>
                <div class="js-goal-show">
                  <%= render "goals/show", goal: goal %>
                </div>
              <% end %>
            <% else %>
              <p class="my-goal">みせってい</p>
            <% end %>
              <form name="sort_form" class="select-box">
                <select name="sort" onchange="dropsort()">
                  <option value="">せんたくできます</option>
                  <% @goals.each do |goal| %>
                    <option value="/goals/<%= goal.id %>"><%= goal.category %></option>
                  <% end %>
                </select>
              </form>
              <a class="js-modal-open" href="" data-target="modal-new-goal">せっていする</a>
              <%= render "goals/new", goal: @goal %>
          </div>
          <div class="menu-icon">
            <a class="js-modal-open" href="" data-target="modal-new-doc">
              <img src="/assets/icon/save-point.png"></br>
              きろくする
            </a>
          </div>
          <%= render "documents/new", document: @document %>
      </div>
      <div class="col-lg-9 col-md-12 col-sm-12">
        <% if @documents.exists? then %>
         <h3 class="master-message upper-contents">これまでのきろくじゃ</h3>
           <%= form_with model: @goal do |f| %>
             <div class="form-group">
               <%= f.select :goal_id, @goals.all.map { |goal| [goal.category, goal.id] }, {include_blank: 'もくひょうでわける'},
                   {class: 'js-select-box'} %>
             </div>
           <% end %>
          <%= render "users/card", documents: @documents_index, document: @document, user: @user %>
        <% elsif @goals.blank? then %>
          <h3 class="master-message upper-contents">「<span class="cat-header">もくひょう</span>」をおして</br>
          せっていしてみるのじゃ！</h3>
        <% else %>
          <h3 class="master-message upper-contents">まだきろくはないぞ。</br>
          とうこうしてみるのじゃ！</h3>
        <% end %>
      </div>
    </div>
  </div>
</div>

